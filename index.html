<!DOCTYPE html>

<html>

    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF8">
		<title>ErinSpace</title>
		<link rel="stylesheet" type="text/css" href="./css/style.css"/>
		<link rel="stylesheet" type="text/css" href="./css/bootstrap.css"/>
        <link rel="stylesheet" type="text/css" href="./css/bootstrap-responsive.css"/>
        <script type = "text/javascript" src="./js/d3.v3.js"></script>
        <script type="text/javascript" src="./js/jquery-1.10.2.js"></script>
		<script type="text/javascript" src="./js/bootstrap.js"></script>

        <!-- show the plot on load -->
        <script type="text/javascript">
            $( document ).ready(function() {
                updatePlot();
            });
        </script>

        <!-- Google analytics, cause why not -->
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-15229886-1', 'erinspace.net');
            ga('send', 'pageview');
        </script>

	</head>

	<body>

        <script>

            // load the XML and set up the data object
            var source = "systems.xml";
            var data = [];
            var data_nonzero = [];

            // extracting objects from the XML
            d3.xml(source, "text/xml", function(xml) {
                d3.select(xml).selectAll("planet").each(
                    function() {

                        var planet = {};

                        var name = d3.select(this).select("name");
                        var mass = d3.select(this).select("mass");
                        var radius = d3.select(this).select("radius");
                        var period = d3.select(this).select("period");
                        var semimajoraxis = d3.select(this).select("semimajoraxis");
                        var discoverymethod = d3.select(this).select("discoverymethod");
                        var discoveryyear = d3.select(this).select("discoveryyear");

                        // check to see if the planet has all the properties we want
                        // and add it to the data object if it does
                        if(name[0][0] && mass[0][0] && radius[0][0] && period[0][0] && semimajoraxis[0][0] && discoverymethod[0][0] && discoveryyear[0][0]) {
                            planet.name = name.text();
                            planet.mass = mass.text();
                            planet.radius = radius.text();
                            planet.period = period.text();
                            planet.semimajoraxis = semimajoraxis.text();
                            planet.discoverymethod = discoverymethod.text();
                            planet.discoveryyear = discoveryyear.text();

                            data.push(planet);
                        }

                        // trying a solution to the log problem, this dosen't work though!
                        if(name[0][0] && mass[0][0] && radius[0][0] && period[0][0] && semimajoraxis[0][0] && discoverymethod[0][0] && discoveryyear[0][0]) {
                            planet.name = name.text();
                            planet.mass = mass.text();
                            planet.radius = radius.text();
                            planet.period = period.text();
                            planet.semimajoraxis = semimajoraxis.text();
                            planet.discoverymethod = discoverymethod.text();
                            planet.discoveryyear = discoveryyear.text();

                            if(planet.mass != "0" && planet.radius != "0") {
                                data_nonzero.push(planet);
                            }
                        }
                    }
                );
            });

            //set the standard display parameter
            var display = 'mass';

            var xkey = "period";
            var ykey = "mass";
            var point_radius = "radius";
            var point_color = "discoveryyear";

             // set up the scatterplot variables
            var margin = {top: 20, right: 20, bottom: 30, left: 40},
                width = 600 - margin.left - margin.right,
                height = 600 - margin.top - margin.bottom;

            // set up information for the svg element
            var x = d3.scale.linear()
                    .range([0, width]);

            var y = d3.scale.linear()
                    .range([height, 0]);

            var color = d3.scale.category10();

            var x_axis = d3.svg.axis()
                        .scale(x)
                        .orient("bottom");

            var y_axis = d3.svg.axis()
                        .scale(y)
                        .orient("left");

            // creates experimental transition maybe?


            // function to update the test bar graph
            var updateGraph = function() {
                console.log(data);
                console.log(data_nonzero);
                console.log(display);
                console.log(xkey);
                console.log(ykey);

                d3.select("#graph")
                    .selectAll("div")
                        .data(data)
                    .enter().append("div")
                        .style("width", function(d) { return d[display] * 100 + "px"; })
                        .text(function(d) { return d[display]; });
            }


            var updatePlot = function() {

                // read the values from the axes select choices
                xkey = $(xaxis).val();
                ykey = $(yaxis).val();
                point_color = $(pointcolor).val();
                point_radius = $(pointradius).val();

                // get rid of the old graph
                d3.select("svg").remove();

                // create a new svg element
                // made this global -- fix later?!?!
                svg = d3.select("#plot")
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                // set domains for both x and y
                x.domain(d3.extent(data, function(d) { return d[xkey]; })).nice();
                y.domain(d3.extent(data, function(d) { return d[ykey]; })).nice();

                // adds different 'g' elements to the svg plot
                // x axis
                svg.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + height + ")")
                    .call(x_axis)
                .append("text")
                    .attr("class", "label")
                    .attr("x", width)
                    .attr("y", -6)
                    .style("text-anchor", "end")
                    .text(xkey);

                // y-axis
                svg.append("g")
                    .attr("class", "y axis")
                    .call(y_axis)
                .append("text")
                    .attr("class", "label")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 6)
                    .attr("dy", ".71em")
                    .style("text-anchor", "end")
                    .text(ykey);

                // add the circles to the graph
                svg.selectAll(".dot")
                    .data(data)
                .enter().append("circle")
                    .attr("class", "dot")
                    .attr("r", function(d) { return d[point_radius] * 3 ; })
                    .attr("cx", function(d) { return x(d[xkey]); })
                    .attr("cy", function(d) { return y(d[ykey]); })
                    .style("fill", function(d) { return color(d[point_color]); });

                // d3.select("input").on("change", change);
                change();

                // get rid of the old legend - does not work right now
                svg.selectAll(".legend").remove();

                //Exit rectangles - ok now this got rid of the legend altogether
                // legend.exit().remove();

                // create a color legend
                var legend = svg.selectAll(".legend")
                    .data(color.domain())
                .enter().append("g")
                    .attr("class", "legend")
                    .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

                // add the legend colors to the svg object
                legend.append("rect")
                    .attr("x", width - 18)
                    .attr("width", 18)
                    .attr("height", 18)
                    .style("fill", color);

                // add text to the legend
                legend.append("text")
                    .attr("x", width - 24)
                    .attr("y", 9)
                    .attr("dy", ".35em")
                    .style("text-anchor", "end")
                    .text(function(d) { return d; });
            };

            function change() {

                var x0 = x.domain(d3.extent(data, function(d) { return d[xkey]; })).nice();

                var transition = svg.transition().duration(750),
                    delay = function(d, i) { return i * 50; };

                transition.selectAll(".dot")
                        .delay(delay)
                        .attr("x", function(d) { return x0(d[xkey]); });

                transition.select("x.axis")
                        .call(x_axis)
                    .selectAll("g")
                        .delay(delay);

            }


        </script>

            <div class="container">

                <div class="container-fluid">
                    <h1>Exoplanets</h1>
                    <div class="row-fluid">
                        <div class="span3">
                            <button type="button" class="btn btn-default" onclick="updateGraph()">Graph Me</button>
                            <button type="button" class="btn btn-default" onclick="updatePlot()">Plot Me</button>
                            <br/>
                            <table>
                                <tr>
                                    <td>x-axis</td>
                                    <td>
                                        <select id="xaxis" class="form-control" onchange="updatePlot()">
                                            <option value="radius">Radius</option>
                                            <option value="mass">Mass</option>
                                            <option value="period">Period</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td>y-axis</td>
                                    <td>
                                        <select id="yaxis" class="form-control" onchange="updatePlot()">
                                            <option value="radius">Radius</option>
                                            <option value="mass">Mass</option>
                                            <option value="period">Period</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td>size</td>
                                    <td>
                                        <select id="pointradius" class="form-control" onchange="updatePlot()">
                                            <option value="radius">Radius</option>
                                            <option value="mass">Mass</option>
                                            <option value="period">Period</option>
                                        </select>
                                    </td>
                                </tr>
                                 <tr>
                                    <td>color</td>
                                    <td>
                                        <select id="pointcolor" class="form-control" onchange="updatePlot()">
                                            <option value="discoveryyear">discovery year</option>
                                            <option value="discoverymethod">discovery method</option>
                                        </select>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="span9">
                            <div id="plot"></div>
                            <div id="graph">This will be the test bar chart</div>
                        </div>
                    </div>
                </div>
            </div>

	</body>


</html>